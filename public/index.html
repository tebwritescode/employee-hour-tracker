<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Employee Hour Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hour Tracker">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/icon-76x76.png">
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="/icons/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1284x2778.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1170x2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1242x2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-828x1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    
    <!-- Standard Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Track and analyze employee work hours with beautiful analytics and reporting">
    <meta name="keywords" content="employee, time tracking, analytics, productivity, business">
    <meta name="author" content="tebwritescode">
    
    <link rel="stylesheet" href="/style.css">
    <script src="chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- PWA Detection and Conditional Header -->
        <header id="desktop-header">
            <h1>Employee Hour Tracker</h1>
            <nav>
                <button id="time-tracking-tab" class="nav-btn active">Time Tracking</button>
                <button id="analytics-tab" class="nav-btn">Analytics</button>
                <button id="management-tab" class="nav-btn">Management</button>
            </nav>
        </header>

        <!-- iOS-Style PWA Header -->
        <header id="pwa-header" class="pwa-header" style="display: none;">
            <div class="pwa-title-bar">
                <div class="pwa-title">
                    <img src="/logo.png" alt="Hour Tracker" class="pwa-logo" style="height: 32px; width: 32px; margin-right: 8px; vertical-align: middle;">
                    <h1>Hour Tracker</h1>
                </div>
                <button id="pwa-settings-btn" class="pwa-settings-btn">
                    <span>👤</span>
                </button>
            </div>
            
            <!-- iOS-style Employee Picker -->
            <div class="pwa-employee-selector">
                <select id="pwa-employee-picker" class="pwa-picker">
                    <option value="">Select Employee...</option>
                </select>
            </div>
            
            <!-- iOS-style Week Navigation -->
            <div class="pwa-week-nav">
                <button id="pwa-prev-week" class="pwa-nav-btn">‹</button>
                <div class="pwa-week-display">
                    <span id="pwa-week-text">This Week</span>
                    <span id="pwa-date-range" class="pwa-date-range">Loading...</span>
                </div>
                <button id="pwa-next-week" class="pwa-nav-btn">›</button>
            </div>
        </header>

        <div id="time-tracking-section" class="section active">
            <div class="week-selector">
                <button id="prev-week">&larr;</button>
                <input type="date" id="week-picker">
                <button id="next-week">&rarr;</button>
                <span id="week-display"></span>
                <button id="share-tracker" class="btn btn-share" title="Share this view">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                        <polyline points="16 6 12 2 8 6"></polyline>
                        <line x1="12" y1="2" x2="12" y2="15"></line>
                    </svg>
                    Share
                </button>
            </div>

            <div class="time-grid-container">
                <table id="time-grid" class="time-grid">
                    <thead>
                        <tr>
                            <th class="employee-header">Employee</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                            <th>Saturday</th>
                            <th>Sunday</th>
                        </tr>
                    </thead>
                    <tbody id="time-grid-body">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="analytics-section" class="section">
            <div class="analytics-header">
                <h2>Analytics Dashboard</h2>
                <div class="export-buttons">
                    <button id="share-analytics" class="btn btn-share" title="Share this view">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                            <polyline points="16 6 12 2 8 6"></polyline>
                            <line x1="12" y1="2" x2="12" y2="15"></line>
                        </svg>
                        Share
                    </button>
                    <button id="export-csv" class="btn btn-secondary">Export CSV</button>
                    <button id="export-json" class="btn btn-secondary">Export JSON</button>
                </div>
            </div>

            <!-- Employee Selection Section -->
            <div class="employee-focus-section">
                <div class="employee-selector">
                    <h3>View Analytics For:</h3>
                    <div class="employee-selection-buttons">
                        <button id="all-employees-btn" class="employee-filter-btn active">All Employees</button>
                        <div id="individual-employees" class="individual-employee-buttons">
                            <!-- Employee buttons will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="date-range-controls">
                <div class="date-preset-buttons">
                    <button id="preset-week" class="btn btn-preset active">Last Week</button>
                    <button id="preset-month" class="btn btn-preset">Last Month</button>
                    <button id="preset-90days" class="btn btn-preset">Last 90 Days</button>
                    <button id="preset-custom" class="btn btn-preset">Custom Range</button>
                </div>
                <div class="custom-date-range" id="custom-date-range" style="display: none;">
                    <input type="date" id="start-date" class="date-input">
                    <span class="date-separator">to</span>
                    <input type="date" id="end-date" class="date-input">
                    <button id="apply-date-range" class="btn btn-primary">Apply</button>
                </div>
                <div class="analytics-options" style="margin-top: 10px;">
                    <button id="toggle-include-empty" class="btn btn-preset active" style="width: auto;">
                        <span id="include-empty-icon">✓</span> Include Empty
                    </button>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="stat-card">
                    <h3>Total Employees</h3>
                    <div class="stat-value" id="total-employees">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Weeks Tracked</h3>
                    <div class="stat-value" id="total-weeks">0</div>
                </div>
                <div class="stat-card empty">
                    <h3>Total Empty</h3>
                    <div class="stat-value" id="total-empty">0</div>
                </div>
                <div class="stat-card not-entered">
                    <h3>Total Not Entered</h3>
                    <div class="stat-value" id="total-not-entered">0</div>
                </div>
                <div class="stat-card entered">
                    <h3>Total Entered</h3>
                    <div class="stat-value" id="total-entered">0</div>
                </div>
                <div class="stat-card incorrect">
                    <h3>Total Incorrect</h3>
                    <div class="stat-value" id="total-incorrect">0</div>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <h3>Overall Status Distribution</h3>
                    <canvas id="overall-chart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Employee Performance</h3>
                    <canvas id="employee-chart"></canvas>
                </div>
            </div>
        </div>

        <div id="management-section" class="section">
            <div id="login-form" class="login-container">
                <h2>Management Login</h2>
                <form id="auth-form">
                    <input type="text" id="username" placeholder="Username" required>
                    <input type="password" id="password" placeholder="Password" required>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                <div id="login-error" class="error-message"></div>
            </div>

            <div id="management-content" class="management-content" style="display: none;">
                <div class="management-header">
                    <h2>Employee Management</h2>
                    <button id="logout-btn" class="btn btn-secondary">Logout</button>
                </div>
                
                <div class="add-employee-form">
                    <h3>Add New Employee</h3>
                    <form id="add-employee-form">
                        <input type="text" id="employee-name" placeholder="Employee Name" required>
                        <button type="submit" class="btn btn-primary">Add Employee</button>
                    </form>
                </div>

                <div class="employees-list">
                    <h3>Current Employees</h3>
                    <div id="employees-container"></div>
                </div>

                <div class="settings-management">
                    <h3>Application Settings</h3>
                    <div class="setting-item">
                        <label for="default-week-offset">Default Week to Launch To:</label>
                        <select id="default-week-offset" class="setting-input">
                            <option value="0">Current Week</option>
                            <option value="-1">Last Week</option>
                            <option value="-2">2 Weeks Ago</option>
                            <option value="-3">3 Weeks Ago</option>
                            <option value="-4">4 Weeks Ago</option>
                            <option value="1">Next Week</option>
                        </select>
                        <button id="save-week-setting" class="btn btn-primary">Save</button>
                    </div>
                    
                    <div class="setting-item">
                        <label for="app-timezone">Application Timezone (affects all users):</label>
                        <select id="app-timezone" class="setting-input">
                            <option value="America/New_York">Eastern Time (EST/EDT)</option>
                            <option value="America/Chicago">Central Time (CST/CDT)</option>
                            <option value="America/Denver">Mountain Time (MST/MDT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PST/PDT)</option>
                            <option value="UTC">UTC (GMT)</option>
                            <option value="Europe/London">GMT (London)</option>
                            <option value="Europe/Berlin">CET (Berlin)</option>
                            <option value="Asia/Tokyo">JST (Tokyo)</option>
                        </select>
                        <button id="save-timezone-setting" class="btn btn-primary">Save</button>
                    </div>
                    
                    <div id="settings-message" class="message"></div>
                </div>

                <div class="credential-management">
                    <h3>Change Admin Credentials</h3>
                    <div class="password-requirements">
                        <strong>Password Requirements:</strong>
                        <ul>
                            <li>At least 8 characters long</li>
                            <li>Must contain uppercase and lowercase letters</li>
                            <li>Must contain at least one number</li>
                            <li>Cannot contain "admin" or "password"</li>
                        </ul>
                    </div>
                    <form id="change-credentials-form">
                        <div class="credential-fields">
                            <input type="text" id="new-username" placeholder="New Username" required>
                            <input type="password" id="new-password" placeholder="New Password" required>
                            <input type="password" id="confirm-password" placeholder="Confirm Password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Credentials</button>
                    </form>
                    <div id="credential-message" class="message"></div>
                </div>

                <div class="api-tokens-section">
                    <h3>🔑 API Tokens</h3>
                    <p>Generate API tokens for external integrations and programmatic access.</p>
                    
                    <div class="token-create-form">
                        <h4>Create New Token</h4>
                        <form id="create-token-form">
                            <div class="form-row">
                                <input type="text" id="token-name" placeholder="Token Name (e.g., 'Integration API')" required>
                                <input type="date" id="token-expires" title="Leave empty for no expiration">
                                <button type="submit" class="btn btn-primary">Generate Token</button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="new-token-display" class="token-display" style="display: none;">
                        <h4>⚠️ Save Your Token</h4>
                        <p><strong>This token will only be shown once. Copy it now:</strong></p>
                        <div class="token-value">
                            <input type="text" id="generated-token" readonly>
                            <button id="copy-token-btn" class="btn btn-secondary">Copy</button>
                        </div>
                    </div>
                    
                    <div class="existing-tokens">
                        <h4>Active Tokens</h4>
                        <div id="tokens-list"></div>
                    </div>
                    
                    <div class="api-docs-info">
                        <h4>📚 API Documentation</h4>
                        <p>Complete API documentation with interactive testing is available at:</p>
                        <div class="code-inline">
                            <code>/api-docs</code>
                            <button id="copy-docs-url" class="btn btn-secondary btn-small">Copy URL</button>
                        </div>
                        <p><small>Use your API tokens in the X-API-Token header for authenticated requests.</small></p>
                    </div>
                    
                    <div id="token-message" class="message"></div>
                </div>

                <div class="settings-management">
                    <h3>⚙️ API Rate Limits</h3>
                    <p>Configure rate limiting for API requests. Changes take effect immediately.</p>
                    
                    <div class="setting-item">
                        <label for="api-limit-unauthenticated">Unauthenticated requests per minute:</label>
                        <input type="number" id="api-limit-unauthenticated" class="setting-input" min="1" max="10000" placeholder="100">
                        <button id="save-unauthenticated-limit" class="btn btn-primary">Save</button>
                    </div>
                    
                    <div class="setting-item">
                        <label for="api-limit-authenticated">Authenticated requests per minute:</label>
                        <input type="number" id="api-limit-authenticated" class="setting-input" min="1" max="50000" placeholder="1000">
                        <button id="save-authenticated-limit" class="btn btn-primary">Save</button>
                    </div>
                    
                    <div class="setting-item">
                        <label for="api-limit-window">Rate limit window (minutes):</label>
                        <input type="number" id="api-limit-window" class="setting-input" min="1" max="60" placeholder="1">
                        <button id="save-window-limit" class="btn btn-primary">Save</button>
                    </div>
                    
                    <div id="rate-limit-message" class="message"></div>
                </div>

                <div class="danger-zone">
                    <h3>⚠️ Danger Zone</h3>
                    <p class="danger-warning">The actions below are irreversible and will permanently delete data.</p>
                    
                    <div class="danger-action">
                        <h4>Clear Only Analytics Data</h4>
                        <p>This will permanently delete all time entries but keep employee records intact.</p>
                        <input type="text" id="clear-analytics-confirmation" placeholder="Type 'CLEAR ANALYTICS' to confirm" class="danger-input">
                        <button id="clear-analytics-btn" class="btn btn-warning" disabled>Clear Analytics Data</button>
                    </div>
                    
                    <div class="danger-action">
                        <h4>Clear Only Employee Data</h4>
                        <p>This will permanently delete all employees and their associated time entries.</p>
                        <input type="text" id="clear-employees-confirmation" placeholder="Type 'CLEAR EMPLOYEES' to confirm" class="danger-input">
                        <button id="clear-employees-btn" class="btn btn-warning" disabled>Clear Employee Data</button>
                    </div>
                    
                    <div class="danger-action">
                        <h4>Clear Specific Time Period</h4>
                        <p>Delete time entries for a specific date range while keeping employees.</p>
                        <div class="time-period-controls">
                            <input type="date" id="clear-start-date" class="danger-input">
                            <span>to</span>
                            <input type="date" id="clear-end-date" class="danger-input">
                        </div>
                        <input type="text" id="clear-period-confirmation" placeholder="Type 'CLEAR PERIOD' to confirm" class="danger-input">
                        <button id="clear-period-btn" class="btn btn-warning" disabled>Clear Time Period</button>
                    </div>
                    
                    <div class="danger-action">
                        <h4>Delete All Data</h4>
                        <p>This will permanently delete all employees, time entries, and related data. This cannot be undone.</p>
                        <input type="text" id="delete-confirmation" placeholder="Type 'DELETE ALL DATA' to confirm" class="danger-input">
                        <button id="delete-all-data-btn" class="btn btn-danger" disabled>Delete All Data</button>
                    </div>
                    
                    <div id="danger-message" class="message"></div>
                </div>

                <div class="app-info">
                    <h3>Application Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Version:</strong> <span id="management-version">Loading...</span>
                        </div>
                        <div class="info-item">
                            <strong>Created by:</strong> 
                            <a href="https://github.com/tebwritescode" target="_blank">tebwritescode</a>
                        </div>
                        <div class="info-item">
                            <strong>Docker Hub:</strong> 
                            <a href="https://hub.docker.com/u/tebwritescode" target="_blank">tebwritescode</a>
                        </div>
                        <div class="info-item">
                            <strong>Website:</strong> 
                            <a href="https://teb.codes" target="_blank">teb.codes</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- iOS-Style PWA Single Employee Week View -->
        <div id="pwa-section" class="pwa-section" style="display: none;">
            <div class="pwa-content">
                <!-- Employee Info Card -->
                <div id="pwa-employee-info" class="pwa-employee-card">
                    <div class="pwa-employee-avatar">👤</div>
                    <div class="pwa-employee-details">
                        <h2 id="pwa-employee-name">Select Employee</h2>
                        <span id="pwa-employee-status" class="pwa-status-badge">No employee selected</span>
                    </div>
                </div>

                <!-- Weekly Status List -->
                <div class="pwa-week-list">
                    <div class="pwa-day-item" data-day="monday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Monday</span>
                            <span class="pwa-day-date" id="pwa-date-monday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="monday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>

                    <div class="pwa-day-item" data-day="tuesday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Tuesday</span>
                            <span class="pwa-day-date" id="pwa-date-tuesday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="tuesday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>

                    <div class="pwa-day-item" data-day="wednesday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Wednesday</span>
                            <span class="pwa-day-date" id="pwa-date-wednesday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="wednesday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>

                    <div class="pwa-day-item" data-day="thursday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Thursday</span>
                            <span class="pwa-day-date" id="pwa-date-thursday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="thursday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>

                    <div class="pwa-day-item" data-day="friday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Friday</span>
                            <span class="pwa-day-date" id="pwa-date-friday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="friday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>

                    <div class="pwa-day-item" data-day="saturday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Saturday</span>
                            <span class="pwa-day-date" id="pwa-date-saturday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="saturday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>

                    <div class="pwa-day-item" data-day="sunday">
                        <div class="pwa-day-info">
                            <span class="pwa-day-name">Sunday</span>
                            <span class="pwa-day-date" id="pwa-date-sunday"></span>
                        </div>
                        <button class="pwa-status-btn" data-day="sunday" data-status="empty">
                            <span class="pwa-status-icon">○</span>
                            <span class="pwa-status-text">Empty</span>
                        </button>
                    </div>
                </div>

                <!-- Weekly Summary -->
                <div class="pwa-week-summary">
                    <div class="pwa-summary-item">
                        <span class="pwa-summary-value" id="pwa-entered-count">0</span>
                        <span class="pwa-summary-label">Entered</span>
                    </div>
                    <div class="pwa-summary-item">
                        <span class="pwa-summary-value" id="pwa-missing-count">0</span>
                        <span class="pwa-summary-label">Missing</span>
                    </div>
                    <div class="pwa-summary-item">
                        <span class="pwa-summary-value" id="pwa-completion-rate">0%</span>
                        <span class="pwa-summary-label">Complete</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer style="text-align: center; padding: 20px; margin-top: 40px; border-top: 1px solid #e0e0e0; color: #666; font-size: 14px;">
        Employee Hour Tracker <span id="app-version">Loading...</span> | 
        Created by <a href="https://github.com/tebwritescode" target="_blank" style="color: #6f42c1;">tebwritescode</a> | 
        <a href="https://teb.codes" target="_blank" style="color: #6f42c1;">teb.codes</a>
    </footer>

    <script src="script.js"></script>
    
    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-banner-content">
            <div class="pwa-banner-text">
                <h4>📱 Install Hour Tracker</h4>
                <p>Add to your home screen for the best experience</p>
            </div>
            <div class="pwa-banner-actions">
                <button id="pwa-install-btn" class="btn btn-primary">Install</button>
                <button id="pwa-dismiss-btn" class="btn btn-secondary">Later</button>
            </div>
        </div>
    </div>
    
    <!-- Service Worker Registration -->
    <script>
        // PWA Installation
        let deferredPrompt;
        let installBanner = document.getElementById('pwa-install-banner');
        let installBtn = document.getElementById('pwa-install-btn');
        let dismissBtn = document.getElementById('pwa-dismiss-btn');

        // Check if already installed
        function isStandalone() {
            return window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches;
        }

        function isMobileDevice() {
            // Check for mobile user agents and screen size
            const userAgent = navigator.userAgent;
            const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isSmallScreen = window.innerWidth <= 768 || window.innerHeight <= 768;
            const hasTouchScreen = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            return isMobileUA || (isSmallScreen && hasTouchScreen);
        }

        // Show install banner for iOS Safari (manual instruction)
        function showIOSInstallInstructions() {
            if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !isStandalone()) {
                // Create iOS-specific install instructions
                setTimeout(() => {
                    const banner = document.createElement('div');
                    banner.className = 'ios-install-banner';
                    banner.innerHTML = `
                        <div class="ios-install-content">
                            <p>📱 <strong>Install Hour Tracker</strong></p>
                            <p>Tap the Share button <span style="font-size: 18px;">⬆️</span> then "Add to Home Screen"</p>
                            <button onclick="this.parentElement.parentElement.remove()" class="btn btn-secondary btn-small">Got it</button>
                        </div>
                    `;
                    document.body.appendChild(banner);
                }, 3000);
            }
        }

        // Listen for install prompt (Android/Chrome)
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Only show PWA install prompt on mobile devices
            if (!isStandalone() && isMobileDevice()) {
                installBanner.style.display = 'flex';
            }
        });

        // Handle install button click
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('PWA install outcome:', outcome);
                deferredPrompt = null;
            }
            installBanner.style.display = 'none';
        });

        // Handle dismiss button click
        dismissBtn.addEventListener('click', () => {
            installBanner.style.display = 'none';
            localStorage.setItem('pwa-dismissed', Date.now());
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    if (confirm('New version available! Refresh to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // Show iOS install instructions if appropriate
        window.addEventListener('load', () => {
            // Don't show if already dismissed recently (24 hours)
            const dismissed = localStorage.getItem('pwa-dismissed');
            const dayAgo = Date.now() - (24 * 60 * 60 * 1000);
            
            if (!dismissed || dismissed < dayAgo) {
                showIOSInstallInstructions();
            }
        });
    </script>
    
    <style>
        /* PWA Install Banner Styles */
        .pwa-install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pwa-banner-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .pwa-banner-text h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
        }

        .pwa-banner-text p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .pwa-banner-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .pwa-banner-actions .btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* iOS Install Banner */
        .ios-install-banner {
            position: fixed;
            top: 60px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .ios-install-content p {
            margin: 8px 0;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .pwa-banner-content {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
            
            .pwa-banner-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</body>
</html>